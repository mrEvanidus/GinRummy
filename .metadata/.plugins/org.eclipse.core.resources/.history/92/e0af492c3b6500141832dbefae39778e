package edu.up.cs301.slapjack;

import java.util.ArrayList;
import edu.up.cs301.card.*;
import android.graphics.*;
import android.view.MotionEvent;

public class CardAnimator implements edu.up.cs301.animation.Animator {

	private static final int FRAME_INTERVAL = 10;
	private static final int BACKGROUND_COLOR = 0xff278734;

	private ArrayList<CardPath> paths;
	protected ArrayList<Card> cards;
	protected ArrayList<RectF> cardPos;

	//the width and hieght of the card
	private static PointF cardDimensions;

	public static PointF getCardDimensions() {
		return cardDimensions;
	}

	public static void setCardDimensions(PointF cardDimensions) {
		CardAnimator.cardDimensions = cardDimensions;
	}

	//constructor
	public CardAnimator() {
		super();

		//initialize the arraylists
		cards = new ArrayList<Card>();
		cardPos = new ArrayList<RectF>();

		cardDimensions = new PointF(261, 379);
		paths = new ArrayList<CardPath>();

		//create a new card
		cards.add(new Card(Rank.ACE, Suit.Spade));
		cardPos.add(new RectF(0,0,0,0));
	}

	public int interval() {
		return FRAME_INTERVAL;
	}

	public int backgroundColor() {
		return BACKGROUND_COLOR;
	}

	public boolean doPause() {
		return false;
	}

	public boolean doQuit() {
		return false;
	}

	public void tick(Canvas canvas) {

		//advance and draw the card paths
		for (CardPath path : paths)  {
			int idx = paths.indexOf(path);

			//advance the card along the path
			RectF newPos = path.advance();

			//draw the card
			path.drawOn(canvas);

			//update the location information
			cardPos.set(idx, newPos);

			if (path.isComplete()) {
				//if the animation is done, get the card back and end the animation
				cards.add(path.getCard());
				paths.remove(idx);
			}
		}
	}

	public void onTouch(MotionEvent event) {
		// TODO Auto-generated method stub

		float x = event.getX();
		float y = event.getY();

		//teleport the card to the coordinates
		//		cardPos = new RectF(x,y,x + cardDimensions.x, y + cardDimensions.y);

		//TODO find which card we are touching and select that one

		float origX = cardPos.get(0).left;
		float origY = cardPos.get(0).top;
		//move the card to the tapped location along a path
		paths.add(new CardPath(cards.get(0), new PointF(origX, origY), new PointF(x, y)));

	}
}
